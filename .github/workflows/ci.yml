name: Continuous integration
on: pull_request
jobs:
  ci:
    runs-on: ubuntu-24.04
    steps:
    - name: Checkout
      uses: actions/checkout@9bb56186c3b09b4f86b1c65136769dd318469633 # v4.1.2
    - uses: actions/setup-node@60edb5dd545a775178f52524783378180af0d1f8 # v4.0.2
      with:
        node-version-file: '.node-version'
        cache: 'npm'
        cache-dependency-path: 'package-lock.json'
    - name: Install apt deps
      run: sudo apt-get install clang-format ninja-build
    - name: Install npm deps
      run: npm ci
    - name: Build library
      run: make lib
    - name: Typecheck
      run: make typecheck
    - name: Check formatting
      run: make checkformat
    - name: Run tests
      run: make test
